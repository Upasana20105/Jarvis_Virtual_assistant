<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JARVIS</title>

<style>
body {
    margin: 0;
    background: radial-gradient(circle at center, #020617, #000);
    color: #7dd3fc;
    font-family: 'Segoe UI', Arial;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* Main Container */
.jarvis-container {
    text-align: center;
}

/* ARC REACTOR */
.arc {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    border: 4px solid rgba(125, 211, 252, 0.2);
    box-shadow: 0 0 30px #0ea5e9;
    position: relative;
    margin: auto;
}

.arc::before {
    content: "";
    position: absolute;
    inset: 20px;
    border-radius: 50%;
    border: 2px dashed rgba(125, 211, 252, 0.4);
    animation: spin 10s linear infinite;
}

.arc::after {
    content: "";
    position: absolute;
    inset: 55px;
    border-radius: 50%;
    background: radial-gradient(circle, #38bdf8, transparent);
    animation: pulse 2s infinite;
}

/* Listening Animation */
.listening .arc::after {
    animation: pulse-fast 0.6s infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes pulse {
    0% { box-shadow: 0 0 20px #38bdf8; }
    50% { box-shadow: 0 0 45px #38bdf8; }
    100% { box-shadow: 0 0 20px #38bdf8; }
}

@keyframes pulse-fast {
    0% { box-shadow: 0 0 20px #0ea5e9; }
    50% { box-shadow: 0 0 70px #0ea5e9; }
    100% { box-shadow: 0 0 20px #0ea5e9; }
}

/* Text */
h1 {
    margin-top: 20px;
    letter-spacing: 4px;
}

#status {
    margin-top: 10px;
    font-size: 16px;
    opacity: 0.8;
}

/* Chat */
#chat {
    margin-top: 30px;
    width: 320px;
    max-height: 200px;
    overflow-y: auto;
    font-size: 14px;
}
#chat p {
    margin: 6px 0;
}

#bootScreen {
    position: fixed;
    inset: 0;
    background: black;
    color: #38bdf8;
    font-family: "Courier New", monospace;
    font-size: 16px;
    padding: 40px;
    z-index: 9999;
}

#bootText {
    white-space: pre-wrap;
    line-height: 1.6;
}

.jarvis-container {
    text-align: center;
    opacity: 0;
    transition: opacity 1.5s ease;
}

</style>
</head>

<body>
<div id="bootScreen">
    <pre id="bootText"></pre>
</div>

<div class="jarvis-container" id="jarvis">
    <div class="arc"></div>
    <h1>J A R V I S</h1>
    <div id="status">Click arc or say command</div>
    <div id="chat"></div>
</div>

<script>
const bootLines = [
    "INITIALIZING JARVIS AI SYSTEM...\n",
    "Checking core modules .......... OK\n",
    "Loading voice interface ........ OK\n",
    "Connecting to Gemini AI ........ OK\n",
    "Loading music library .......... OK\n",
    "Calibrating arc reactor ........ OK\n",
    "\nALL SYSTEMS ONLINE\n",
    "JARVIS READY\n"
];

let bootIndex = 0;
const bootText = document.getElementById("bootText");

function playBootSequence() {
    if (bootIndex < bootLines.length) {
        bootText.innerHTML += bootLines[bootIndex];
        bootIndex++;
        setTimeout(playBootSequence, 500);
    } else {
        setTimeout(finishBoot, 1000);
    }
}

function finishBoot() {
    document.getElementById("bootScreen").style.display = "none";
    document.getElementById("jarvis").style.opacity = "1";
    speak("All systems online. Hello Upasana.");
}

window.onload = playBootSequence;

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = "en-US";

const jarvisUI = document.getElementById("jarvis");
const statusText = document.getElementById("status");
const chat = document.getElementById("chat");

document.querySelector(".arc").onclick = () => {
    recognition.start();
    jarvisUI.classList.add("listening");
    statusText.innerText = "Listening...";
};

recognition.onresult = async (event) => {
    const text = event.results[0][0].transcript;
    jarvisUI.classList.remove("listening");
    statusText.innerText = "Processing...";

    chat.innerHTML += `<p><b>You:</b> ${text}</p>`;

    const res = await fetch("/command", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ command: text })
    });

    const data = await res.json();
    speak(data.response);
};

recognition.onerror = () => {
    jarvisUI.classList.remove("listening");
    statusText.innerText = "Try again";
};


function cleanForSpeech(text) {
    return text
        .replace(/[#*_`>-]/g, "")     // remove markdown symbols
        .replace(/\n+/g, ". ")        // new lines â†’ pause
        .replace(/\s+/g, " ")         // extra spaces
        .trim();
}



function speak(text) {
    const cleanText = cleanForSpeech(text);

    const msg = new SpeechSynthesisUtterance(cleanText);
    msg.rate = 1;
    msg.pitch = 1;

    speechSynthesis.speak(msg);

    chat.innerHTML += `<p><b>Jarvis:</b> ${cleanText}</p>`;
    statusText.innerText = "Idle";
}

</script>

</body>
</html>
